
DECLARE @pan VARCHAR(100);
DECLARE @pan_list VARCHAR(8000)

SET @pan_list =  '5559405004676511,5559405000003520,5559405000003520,5559405000003520,5559405000003520,5559405000003520,5559405000003520,5559405000003520,5559405000003520,5559405000003751,5559405000003785,5559405000003785,5559405000004007,5559405000004007,5559405000004007,5559405000004007,5559405000004007,5559405000004007,5559405000004007,5559405000004437,5559405000004460,5559405000004460,5559405000004510,5559405000004510,5559405000004981,5559405000004981,5559405000004981,5559405000004981,5559405000004981,5559405000006861,5559405000006994,5559405000010459,5559405000011713,5559405000011713,5559405000011788,5559405000011788,5559405000012919,5559405000013164,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000013297,5559405000014451,5559405000014527,5559405000014873,5559405000014873,5559405000014873,5559405000015102,5559405000015623,5559405000015920,5559405000015920,5559405000016043,5559405000016043,5559405000016043,5559405000016043,5559405000016043,5559405000016324,5559405000016399,5559405000016399,5559405000016639,5559405000016639,5559405000016639,5559405000017702,5559405000017702,5559405000018346,5559405000018353,5559405000018684,5559405000019476,5559405000019476,5559405000019476,5559405000019476,5559405000019476,5559405000020334,5559405000020334,5559405000020482,5559405000020482,5559405000025622,5559405000025622,5559405000025622,5559405000025622,5559405000025622,5559405000025622,5559405000026109,5559405000026174,5559405000026802,5559405000026802,5559405000044375,5559405000044540,5559405000045141,5559405000045141,5559405000045141,5559405000048160,5559405000048160,5559405000048160,5559405005338160,5559405000049440,5559405000049788,5559405000049788,5559405000049788,5559405000049788,5559405000049788,5559405000049788,5559405000049846,5559405000050281,5559405000050281,5559405000050281,5559405000050414,5559405000050885,5559405000050885,5559405000052832,5559405000053376,5559405000054101,5559405000054101,5559405000054580,5559405000054580,5559405000057203,5559405000057674,5559405000057674,5559405000058680,5559405000058680,5559405000059175,5559405000059175,5559405000059431,5559405000059431,5559405000059431,5559405000059431,5559405000059431,5559405000059431,5559405000061353,5559405000061908,5559405000062476,5559405000063037,5559405000063094,5559405000063193,5559405000063193,5559405000063276,5559405000063276,5559405000063276,5559405000063276,5559405000063276,5559405000063276,5559405000063276,5559405000063276,5559405000063276,5559405000063276,5559405000063631,5559405000063631,5559405000063813,5559405000064803,5559405000067053,5559405000067053,5559405000067053,5559405000067053,5559405000067053,5559405000067053,5559405000067335,5559405000067335,5559405000067335,5559405000068127,5559405000068127,5559405000068127,5559405000070032,5559405000070065,5559405000070297,5559405000070321,5559405000070321,5559405000070321,5559405000070321,5559405000070321,5559405000070321,5559405000070321,5559405000070321,5559405000071089,5559405000071089,5559405000071436,5559405000072996,5559405000187174,5559405000375670,5559405000375670,5559405000516554,5559405000567037,5559405000567037,5559405000567037,5559405000567037,5559405000567037,5559405000697826,5559405000735485,5559405000857073,5559405000898028,5559405000898028,5559405000898028,5559405000899059,5559405000899059,5559405000899059,5559405000908579,5559405001122824,5559405001122824,5559405001138499,5559405001138499,5559405001532394,5559405001636336,5559405001825731,5559405001913537,5559405002385628,5559405002470495,5559405002470495,5559405002470495,5559405002470495,5559405002470495,5559405002611783,5559405002680374,5559405002680374,5559405002680374,5559405002680374,5559405002732803,5559405002767668,5559405002767668,5559405002773815,5559405002773815,5559405002773815,5559405002812183,5559405002853393,5559405002853393,5559405002965338,5559405002968464,5559405002968464,5559405002968464,5559405003030918,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003102204,5559405003182594,5559405003421281,5559405003421281,5559405003421281,555940******2739,555940******2739,555940******2739,555940******2739,555940******2739,5559405003600272,5559405003600272,5559405003600272,5559405003608945,5559405003639155,5559405003639155,5559405003639155,5559405003690257,5559405003690257,5559405003690257,5559405003733800,5559405003733800,5559405003814725,5559405003863607,5559405003863607,5559405004007634,5559405004007634,5559405004085457,5559405004229089,5559405004304817,5559405004304817,5559405004304817,5559405004550138,5559405004550138,5559405004639493,5559405004828195,5559405004894403,5559405004894403,5559405004894403,5559405005039495,5559405005203687,5559405005235689,5559405005235689,5559405005235689,5559405005235689,5559405005235689,5559405005235689,5559405005235689,5559405005250514,5559405005250514,5559405005258996,5559405005264663,5559405005264663,5559405005310144,5559405005310144,5559405005310144,5559405005310144,5559405005338160,5559405005341891,5559405005341891,5559405005341891,5559405005348854,5559405005348854,5559405005348854,5559405005348854,5559405005602821,5559405005602821,5559405005904094,5559405005904094,5559405005904094,5559405005904094,5559405005904094,5559405005904094,5559405006259068,5559405006629708,5559405006679992,5559405006679992,5559405006809904,5559405006894815,5559405006894815,5559405006894815,5559405006896067,5559405006896067,5559405006960343,5559405006984582,5559405007187011,5559405007219129,5559405007219129,5559405007245710,5559405007245710,5559405007245710,5559405007298727,5559405007446714,5559405007481216,5559405007505808,5559405007553436,5559405007553436,5559405007553436,5559405007619765,5559405007673754,5559405007673754,5559405007673754,5559405007673754,5559405007673754,5559405007673754,5559405007673754,5559405007673754,5559405007947216,5559405007977924,5559405008030418,5559405008030418,5559405008053444,5559405008072006,5559405008086535,5559405008086535,5559405008105160,5559405008159563,5559405008159563,5559405008265105,5559405008265105,5559405008265105,5559405008265105,5559405008265105,5559405008265105,5559405008265105,5559405008265105,5559405008265105,5559405008379120,5559405008379120,5559405008379120,5559405008433208,5559405008505237,5559405009255287,5559405009255287,5559405009255287,5559405009283016,5559405009290284,5559405009303418,5559405009303418,5559405009615712,5559405009812343,5559405009812343,5559405009812343,5559405009812343,5559405009845368,5559405009934220,5559405009934220,5559405010663487,5559405011607723,5559405011607723,5559405011607723,5559405011607723,5559405011607723,5559405011607723,5559405012418229,5559405012418229,5559405012418229,5559405012418229,5559405012418229,5559405012418229,5559405012418229,5559405012418229,5559405012712159,5559405012712159,5559405012759168,5559405012759168,5559405013574855,5559405013574855,5559405013857284,5559405013857284,5559405015135333,5559405015135333,5559405015922342,5559405015969319,5559405015969319,5559405015969319,5559405015969319,5559405015969319,5559405017807202,5559405017807202,5559405017807202,5559405017807202,5559405017807202,5559405017807202,5559405017807202,5559405018147574,5559405018632435,5559405018759386,5559405018759386,5559405018759386,5559405018759386,5559405018759386,5559405019536213,5559405019536213,5559405019536213,5559405019536213,5559405019536213,5559405019957880,5559405000033550,5559405000033550,5559405000033550,5559405000033550,5559405004789892,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000029939,5559405000030580,5559405000030580,5559405000030580,5559405000030721,5559405000031034,5559405000031034,5559405000032578,5559405000032578,5559405000032693,5559405000032735,5559405000033196,5559405000033287,5559405000033287,5559405000033378,5559405000033550,5559405000045562,5559405000045562,5559405000045752,5559405000045802,5559405000058433,5559405000066592,5559405019530026,5559405019530026,5559405019530026,5559405019530026,5559405000010632';

DECLARE @masked_pan_table TABLE (serial_number INT IDENTITY(1,1), pan VARCHAR(100), left_pan_six CHAR(6), right_pan_four CHAR(4));
INSERT INTO @masked_pan_table (pan) SELECT part FROM usf_split_string(@pan_list, ',')

DECLARE pan_cursor CURSOR LOCAL FORWARD_ONLY STATIC READ_ONLY FOR SELECT pan FROM  @masked_pan_table
OPEN pan_cursor
FETCH NEXT FROM pan_cursor INTO @pan

WHILE (@@FETCH_STATUS =0) BEGIN

 	INSERT INTO @masked_pan_table (left_pan_six, right_pan_four) VALUES (LEFT(@pan, 6), RIGHT(@pan,4))
	FETCH NEXT FROM pan_cursor INTO @pan
END

CLOSE pan_cursor;
DEALLOCATE pan_cursor

SELECT  usf_decrpyt_pan(pan,pan_encrypted) clear_pan, trans.post_tran_cust_id ,abort_rsp_code ,acquirer_network_id ,payee ,pos_condition_code ,pos_entry_mode ,post_tran_id ,prev_post_tran_id ,prev_tran_approved ,pt_pos_card_input_mode ,pt_pos_cardholder_auth_method ,pt_pos_operating_environment ,pt_pos_pin_capture_ability ,pt_pos_terminal_operator ,realtime_business_date ,receiving_inst_id_code ,recon_business_date ,retention_data ,retrieval_reference_nr ,routing_type ,rsp_code_req ,rsp_code_rsp ,settle_amount_impact ,settle_amount_req ,settle_amount_rsp ,settle_cash_req ,settle_cash_rsp ,settle_currency_code ,settle_entity_id ,settle_proc_fee_req ,settle_proc_fee_rsp ,settle_tran_fee_req ,settle_tran_fee_rsp ,sink_node_name ,sponsor_bank ,structured_data_req ,structured_data_rsp ,system_trace_audit_nr ,to_account_id ,to_account_type ,to_account_type_qualifier ,tran_amount_req ,tran_amount_rsp ,tran_cash_req ,tran_cash_rsp ,tran_completed ,tran_currency_code ,tran_nr ,tran_postilion_originated ,tran_proc_fee_currency_code ,tran_proc_fee_req ,tran_proc_fee_rsp ,tran_reversed ,tran_tran_fee_currency_code ,tran_tran_fee_req ,tran_tran_fee_rsp ,tran_type ,ucaf_data ,address_verification_data ,address_verification_result ,card_acceptor_id_code ,card_acceptor_name_loc ,card_product ,card_seq_nr ,check_data ,draft_capture ,expiry_date ,mapped_card_acceptor_id_code ,merchant_type ,pan ,pan_encrypted ,pan_reference ,pan_search ,pos_card_capture_ability ,pos_card_data_input_ability ,pos_card_data_input_mode ,pos_card_data_output_ability ,pos_card_present ,pos_cardholder_auth_ability ,pos_cardholder_auth_entity ,pos_cardholder_auth_method ,pos_cardholder_present ,pos_operating_environment ,pos_pin_capture_ability ,pos_terminal_operator ,pos_terminal_output_ability ,pos_terminal_type ,service_restriction_code ,source_node_name ,terminal_id ,terminal_owner ,totals_group ,acquiring_inst_id_code ,additional_rsp_data ,auth_id_rsp ,auth_reason ,auth_type ,bank_details ,batch_nr ,card_verification_result ,datetime_req ,datetime_rsp ,datetime_tran_gmt ,datetime_tran_local ,extended_tran_type ,from_account_id ,from_account_type ,from_account_type_qualifier ,icc_data_req ,icc_data_rsp ,issuer_network_id ,message_reason_code ,message_type ,next_post_tran_id ,online_system_id ,participant_id FROM post_tran trans (NOLOCK) LEFT JOIN post_tran_cust cust (NOLOCK) ON trans.post_tran_cust_id = cust.post_tran_cust_id 

WHERE LEFT(pan,6) IN (SELECT left_pan_six FROM @masked_pan_table) AND RIGHT(pan,4) IN (SELECT right_pan_four FROM @masked_pan_table) AND datetime_req BETWEEN '2013-11-01' AND '2013-12-01'